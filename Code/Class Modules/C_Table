Option Explicit

Private Function column(columnName)
'
'Shorter way to give columns into formulas
'
        column = Columns(CalcIndex(columnName)).Address(0, 0)
End Function

Public Sub P0()
'
'Level P0
'Poziom P0
'
    
'VALUE
    Add_value C_POZ, "P0"
    'OPT
    Add_LP
    'AREA
    'Add_value C_LVL, ""
    'ELEMENT
    'MR
    'MATERIAL
    'PRICE
    Add_value C_DESCRIPTION, "Część obiektu " & Cells(CalcRow, CalcIndex(C_AREA))
    Add_value C_UNIT, "kpl."
    Add_value C_AMOUNT, "1"
    Add_Amount2
    Add_UnitPrice
    'VALUE
    Add_NetValue
    'COMMENTS
    'SCOPE
    
'FORMAT
    cP_Format
    CalcRange
    With Selection.Interior
        .ThemeColor = COLOR_P0
        .TintAndShade = COLOR_P0v
    End With
    With Selection.Font
        .Bold = True
    End With
    
    CalcRow = CalcRow + 1
End Sub

Public Sub P1()
'
'Level P1
'Poziom P1
'

'VALUE
    Add_value C_POZ, "P1"
    'OPT
    Add_LP
    RowUp C_AREA
    'LVL
    'ELEMENT
    'MR
    'MATERIAL
    'PRICE
    Add_value C_DESCRIPTION, P1_Description(Cells(CalcRow, CalcIndex(C_LVL)).Text)
    Add_value C_UNIT, "kpl."
    Add_value C_AMOUNT, "1"
    Add_Amount2
    Add_UnitPrice
    'VALUE
    Add_NetValue
    'COMMENTS
    'SCOPE
    
'FORMAT
    cP_Format
    CalcRange
    With Selection.Interior
        .ThemeColor = COLOR_P1
        .TintAndShade = COLOR_P1v
    End With
    With Selection.Font
        .Bold = True
    End With
    
    CalcRow = CalcRow + 1
End Sub

Public Sub P2()
'
'Level P2
'Poziom P2
'
    Dim cP2 As New clsP2
    
'VALUE
    Add_value C_POZ, "P2"
    'OPT
    Add_LP
    RowUp C_AREA
    RowUp C_LVL
    'ELEMENT
    'MR
    'MATERIAL
    'PRICE
    Add_value C_DESCRIPTION, cP2.GetNAME(Cells(CalcRow, CalcIndex(C_ELEMENT)).Text)
    Add_value C_UNIT, cP2.GetUNIT(Cells(CalcRow, CalcIndex(C_ELEMENT)).Text)
    Add_value C_AMOUNT, "=SUMIFS(" & column(C_AMOUNT) & "," & column(C_POZ) & ",""P3""," & column(C_LP) & "," & col(C_LP) & "&""*"")"
    Add_Amount2
    Add_UnitPrice
    'VALUE
    Add_NetValue
    'COMMENTS
    'SCOPE
    
'FORMAT
    cP_Format
    CalcRange
    
    With Selection.Interior
        .ThemeColor = COLOR_P2
        .TintAndShade = COLOR_P2v
    End With
    
    With Selection.Font
        .Bold = True
    End With
    
    CalcRow = CalcRow + 1
End Sub

Public Sub P3()
'
'Level P3
'Poziom P3
'
    Dim cP2 As New clsP2
    
'VALUE
    Add_value C_POZ, "P3"
    'OPT
    Add_LP
    RowUp C_AREA
    RowUp C_LVL
    RowUp C_ELEMENT
    'MR
    'MATERIAL
    'PRICE
'DESCRIPTION
    Add_value C_UNIT, cP2.GetUNIT(Cells(CalcRow, CalcIndex(C_ELEMENT)).Text)
    
On Error GoTo err_handler
        Add_value C_AMOUNT, "=" & col(cP2.GetAMOUNT(Cells(CalcRow, CalcIndex(C_ELEMENT)).Text))
err_handler:
        Add_value C_AMOUNT, "=1"
        
    Add_Amount2
    Add_UnitPrice
    'VALUE
    Add_NetValue
    'COMMENTS
    'SCOPE
    
'FROM TABLE
    Dim Tabela_S As Variant
    Set Tabela_S = ThisWorkbook.Sheets(A_TABLE).Cells(1, 1)
    Dim m As Integer
    
    m = WhereInArray(CALC_COLUMNS, CALC_COLUMNS_2(LBound(CALC_COLUMNS_2))) + 1
    Do While m <= WhereInArray(CALC_COLUMNS, CALC_COLUMNS_2(UBound(CALC_COLUMNS_2))) + 1
        Cells(CalcRow, m).Formula = "=GETPIVOTDATA(TEXT(" & Cells(HEADLINE_ROW, m).Address(1, 0) & ",""0""),'" & Worksheets(A_TABLE).name & "'!" & Tabela_S.Address & _
                 ",""5d4d-Bauabschnitt"",TEXT(" & Cells(CalcRow, CalcIndex(C_AREA)).Address(0, 1) & _
        ",""0""),""5d4d-Geschoss"",TEXT(" & Cells(CalcRow, CalcIndex(C_LVL)).Address(0, 1) & _
        ",""00""), ""5d4d-Bauelement"" ,TEXT(" & Cells(CalcRow, CalcIndex(C_ELEMENT)).Address(0, 1) & _
          ",""0""),""Final Name""," & Cells(CalcRow, CalcIndex(C_DESCRIPTION)).Address(0, 1) & ")"
        m = m + 1
    Loop
    
'FORMAT
    cP_Format
    
    With Selection.Interior
        .ThemeColor = COLOR_P3
        .TintAndShade = COLOR_P3v
    End With
    
    CalcRow = CalcRow + 1
    Exit Sub
    
End Sub

Public Sub P4()
'
'Level P4
'Poziom P4
'
    Select Case Cells(CalcRow_Table, CalcIndex(C_ELEMENT)).Text
    
        Case "ZIE"
            Wykop_i_odwoz
            Zasyp
            
        Case "KER"
            Podsypka
            
        Case "CHB"
            Rob_Chudy_Beton
            Beton
            
        Case "FLW"
            Szalunek
            Zbrojenie FD
            Rob_Lawa_fund
            Beton
            
        Case "FPL"
            Szalunek
            Biala_wanna
            Zbrojenie FD
            Rob_Plyta_fund
            Beton

        Case "FST"
            Szalunek
            Zbrojenie FD
            Rob_Stopa_fund
            Beton
            
        Case "KRA"
            Zbrojenie FD
            Rob_Krawedz
            Beton

        Case "SCM"
            Mur
            Zab_ppoz

        Case "SCS", "SCZ"
            Szalunek_H
            Zbrojenie SC
            Rob_Sciana
            Beton

        Case "SLP"
            Szalunek_H
            Zbrojenie SL
            Rob_Slup_prost
            Beton

        Case "SLO"
            Szalunek_H
            Zbrojenie SL
            Rob_Slup_okrag
            Beton
            
        Case "KON"
            Szalunek
            Zbrojenie POD
            Rob_Konsola
            Beton
            
        Case "WSP"
            Szalunek
            Zbrojenie STR_
            Rob_Wspornik
            Beton
            
        Case "STR"
            Szalunek_H_K
            Zbrojenie STR_
            Rob_Strop
            Beton
            Elektronagrzew
            
        Case "SPO"
            Szalunek
            Zbrojenie STR_
            Rob_Spocznik
            Beton
            
        Case "STA"
            Stal
            Stal_ppoz
            If InStr(Cells(CalcRow_Table, CalcIndex(C_DESCRIPTION)).Text, "beton") <> 0 Then Beton
            
        Case "POD"
            Szalunek_H
            Zbrojenie POD
            Rob_Podciag
            Beton
            
        Case "ATT"
            Szalunek
            Zbrojenie SC
            Rob_Attyka
            Beton
            
        Case "DOD"
            Dodatki_do_betonu
            
        Case "PREF"
            Prefabrykat
            Rob_Pref
            If InStr(Cells(CalcRow_Table, CalcIndex(C_DESCRIPTION)).Text, "bieg schodowy") <> 0 Then Elastomer
            
        Case "SCH"
            Szalunek
            Zbrojenie STR_
            Rob_Schody
            Beton
            
        Case "TRZ"
            Szalunek
            Zbrojenie SL
            Rob_Wieniec
            Beton
            
        Case "IZO"
            Izolacja
            
        Case "CMX"
            Comaxy
            
        Case Else
            Niezdefiniowane
            
'
'        Case "SZCZ"
'            cP4.cSZCZ CalcRow_Table
''
''        Case "BER"
''            cP4.cBER CalcRow_Table
            
    End Select
End Sub
